{% extends "maths/base.html" %}
{% block content %}
<h1>{{ level }} - Practice Questions</h1>

<div class="practice-container">
    {% if questions %}
        <div class="practice-header">
            <h2>üéØ Practice Session</h2>
            <p class="practice-info">
                {{ questions|length }} random question{{ questions|length|pluralize }} 
                (from {{ total_questions }} total questions)
            </p>
            <p class="practice-description">
                Practice with questions from all topics. No scoring - just learning!
            </p>
        </div>
        
        <div class="questions-container">
            {% for question in questions %}
                <div class="question-card">
                    <div class="question-header">
                        <h3>Question {{ forloop.counter }}</h3>
                        <div class="question-meta">
                            <span class="difficulty difficulty-{{ question.difficulty }}">
                                {% if question.difficulty == 1 %}Easy{% elif question.difficulty == 2 %}Medium{% else %}Hard{% endif %}
                            </span>
                            <span class="points">{{ question.points }} point{{ question.points|pluralize }}</span>
                        </div>
                    </div>
                    
                    <div class="question-content">
                        <div class="question-text-container">
                            <p class="question-text">{{ question.question_text }}</p>
                            <button class="speaker-btn" onclick="speakText('{{ question.question_text|escapejs }}')" title="Listen to question">
                                üîä
                            </button>
                        </div>
                        
                        {% if question.question_type == 'multiple_choice' and question.answers.exists %}
                            <div class="answers">
                                <h4>Answer Options:</h4>
                                <ul>
                                    {% for answer in question.answers.all %}
                                        <li class="answer-option {% if answer.is_correct %}correct{% endif %}">
                                            {{ answer.answer_text }}
                                            {% if answer.is_correct %}<span class="correct-indicator">‚úì</span>{% endif %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% elif question.question_type == 'true_false' %}
                            <div class="answers">
                                <h4>Answer:</h4>
                                <ul>
                                    {% for answer in question.answers.all %}
                                        <li class="answer-option {% if answer.is_correct %}correct{% endif %}">
                                            {{ answer.answer_text }}
                                            {% if answer.is_correct %}<span class="correct-indicator">‚úì</span>{% endif %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                        
                        {% if question.explanation %}
                            <div class="explanation">
                                <h4>üí° Explanation:</h4>
                                <p>{{ question.explanation }}</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <div class="practice-actions">
            <a href="{% url 'maths:practice_questions' level.level_number %}" class="btn btn-primary">New Practice Set</a>
            <a href="{% url 'maths:level_detail' level.level_number %}" class="btn btn-secondary">Back to Level</a>
        </div>
    {% else %}
        <div class="no-questions">
            <h2>No Questions Available</h2>
            <p>There are no questions for practice yet.</p>
            <a href="{% url 'maths:level_detail' level.level_number %}" class="btn btn-primary">Back to Level</a>
        </div>
    {% endif %}
</div>

<style>
    .practice-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .practice-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        border-radius: 10px;
    }
    
    .practice-header h2 {
        margin-top: 0;
        font-size: 28px;
    }
    
    .practice-info {
        margin-bottom: 10px;
        opacity: 0.9;
        font-size: 16px;
    }
    
    .practice-description {
        margin-bottom: 0;
        opacity: 0.8;
        font-size: 14px;
    }
    
    .questions-container {
        display: grid;
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .question-card {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .question-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e9ecef;
    }
    
    .question-header h3 {
        margin: 0;
        color: #007bff;
    }
    
    .question-meta {
        display: flex;
        gap: 10px;
        font-size: 14px;
    }
    
    .difficulty {
        padding: 4px 8px;
        border-radius: 4px;
        font-weight: bold;
    }
    
    .difficulty-1 {
        background: #d4edda;
        color: #155724;
    }
    
    .difficulty-2 {
        background: #fff3cd;
        color: #856404;
    }
    
    .difficulty-3 {
        background: #f8d7da;
        color: #721c24;
    }
    
    .points {
        background: #e2e3e5;
        color: #495057;
        padding: 4px 8px;
        border-radius: 4px;
    }
    
    .question-content {
        margin-top: 15px;
    }
    
    .question-text-container {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .question-text {
        font-size: 16px;
        line-height: 1.5;
        margin: 0;
        color: #333;
        flex: 1;
    }
    
    .speaker-btn {
        background: #007bff;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        flex-shrink: 0;
    }
    
    .speaker-btn:hover {
        background: #0056b3;
        transform: scale(1.1);
    }
    
    .speaker-btn.playing {
        background: #28a745;
        animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
    
    .answers {
        margin: 15px 0;
    }
    
    .answers h4 {
        margin-bottom: 10px;
        color: #495057;
    }
    
    .answers ul {
        list-style: none;
        padding: 0;
    }
    
    .answer-option {
        padding: 8px 12px;
        margin: 5px 0;
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .answer-option.correct {
        background: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
    }
    
    .correct-indicator {
        color: #28a745;
        font-weight: bold;
    }
    
    .explanation {
        margin-top: 15px;
        padding: 15px;
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        border-radius: 4px;
    }
    
    .explanation h4 {
        margin-top: 0;
        color: #1976d2;
    }
    
    .practice-actions {
        text-align: center;
        margin-top: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .no-questions {
        text-align: center;
        padding: 40px;
        color: #6c757d;
    }
    
    .btn {
        display: inline-block;
        padding: 10px 20px;
        text-decoration: none;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-size: 16px;
        margin: 5px;
    }
    
    .btn-primary {
        background: #007bff;
        color: white;
    }
    
    .btn-secondary {
        background: #6c757d;
        color: white;
    }
    
    .btn:hover {
        opacity: 0.8;
    }
    
    @media (max-width: 768px) {
        .question-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .question-meta {
            flex-wrap: wrap;
        }
    }
</style>

<script>
let currentSpeech = null;

function speakText(text) {
    // Stop any current speech
    if (currentSpeech) {
        speechSynthesis.cancel();
        currentSpeech = null;
        updateSpeakerButtons();
        return;
    }
    
    // Check if speech synthesis is supported
    if (!('speechSynthesis' in window)) {
        alert('Text-to-speech is not supported in this browser.');
        return;
    }
    
    // Create speech utterance
    const utterance = new SpeechSynthesisUtterance(text);
    
    // Configure speech settings
    utterance.rate = 0.8; // Slightly slower for better comprehension
    utterance.pitch = 1;
    utterance.volume = 1;
    
    // Try to use a child-friendly voice
    const voices = speechSynthesis.getVoices();
    const childVoice = voices.find(voice => 
        voice.name.includes('Child') || 
        voice.name.includes('Kid') ||
        voice.lang.startsWith('en') && voice.name.includes('Female')
    );
    
    if (childVoice) {
        utterance.voice = childVoice;
    }
    
    // Event handlers
    utterance.onstart = function() {
        currentSpeech = utterance;
        updateSpeakerButtons();
    };
    
    utterance.onend = function() {
        currentSpeech = null;
        updateSpeakerButtons();
    };
    
    utterance.onerror = function() {
        currentSpeech = null;
        updateSpeakerButtons();
        alert('Error playing audio. Please try again.');
    };
    
    // Start speaking
    speechSynthesis.speak(utterance);
}

function updateSpeakerButtons() {
    const buttons = document.querySelectorAll('.speaker-btn');
    buttons.forEach(btn => {
        if (currentSpeech) {
            btn.classList.add('playing');
            btn.innerHTML = '‚èπÔ∏è';
            btn.title = 'Stop audio';
        } else {
            btn.classList.remove('playing');
            btn.innerHTML = 'üîä';
            btn.title = 'Listen to question';
        }
    });
}

// Load voices when page loads
window.addEventListener('load', function() {
    if ('speechSynthesis' in window) {
        speechSynthesis.getVoices();
    }
});
</script>
{% endblock %}
